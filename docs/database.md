# Описание базы данных пользователей

## Таблица user
| Поле         | Тип            | Описание |
|--------------|----------------|----------|
| user_id      | BIGINT         | Telegram user ID (id пользователя и его чата с ботом) |
| username     | VARCHAR        | Telegram username (если установлен) |
| first_name   | VARCHAR        | Имя пользователя |
| last_name    | VARCHAR        | Фамилия пользователя (если есть) |
| language_code| VARCHAR(5)     | Язык интерфейса Telegram (например, ru, en) |
| is_bot       | BOOLEAN        | Является ли пользователь ботом |
| created_at   | TIMESTAMP      | Дата первого входа в бота |
| updated_at   | TIMESTAMP      | Последнее обновление данных |
| is_active    | BOOLEAN        | Флаг активности (для soft-delete или блокировки) |
| extra        | JSONB          | Дополнительные данные (например, настройки, роли, предпочтения) |
| fsm_data     | JSONB          | Этап взаимодействия бота с пользователем |

## Таблица prompt_chat
Составное сообщение. Сообщение в ТГ, которое состоит из нескольких сообщений выводящихся подряд в определенном порядке и представляющие собой один компонент. В нашем случае хранит промпт состоящий из: название/описание (несколько строк), промпт (текст), медиаданные (группа файлов фото и видео), клавиатура (кнопки для управления промптом).

| Поле         | Тип            | Описание |
|--------------|----------------|----------|
| prompt_id    | BIGINT         | ID (PK) уникальный идентификатор составного сообщения |
| user_id      | BIGINT         | Связь с таблицей user|
| message      | JSONB          | Содержимое промпта |
| prompt_group | BIGINT         | Связь с таблицей prompt_group или Null |

### Содержимое промпта
Структура для сохранения информации о сообщениях:
```
{
    prompt_name: {
        "text": Название/описание промпта,
        "message_id": 12345
    }

    prompt: {
        "text": Содержимое промпта,
        "message_id": 12345
    }

    multimedia: {
        "media_group_id": "abc123xyz",
        "chat_id": -1009876543210,
        "from_id": "отправитель"
        "date": время отправления
        
        "items": [
            {
            "message_id": 12345,
            "file_id": "AgACAgUAAxkBAAIB...",
            "caption": "Первое фото"
            "type": photo / video
            }
        ]
    }

    keyboard: {
        "message_id": 12345 
    }
}
```

## Таблица prompt_group
 Копия записи в prompt_bot с небольшими изменениями.

| Поле              | Тип            | Описание |
|-------------------|----------------|----------|
| prompt_id         | BIGINT         | ID (PK) уникальный идентификатор составного сообщения |
| chat_id           | BIGINT         | ID группы |
| message_thread_id | BIGINT         | ID темы |
| message           | JSONB          | Содержимое промпта |

