# Построение формы

Процесс загрузки страницы @docs/app_security.md.
Коротко: 
- "user", "message_id", "chat" получаются, извлекаются и записываются в глобальное хранилище страницы сразу при ее загрузке. 
- Страница делает запрос шаблона передавая на сервер передает initData и message_id
- В случае успешной авторизации получает "template", "prompt", "prompt_type" и сохраняет полученные данные в то же глобальное хранилище.
- После этого запускается построение формы.
- При неудачной авторизации или ошибке при построении вывести диалог с пояснением и кнопкой Ок. При ее нажатии закрыть страницу.

Страница после авторизации имеет для работы:
```json
{
    "template": json шаблон,
    "prompt": json промпт,
    "user": данные пользователя из тг,
    "message_id": id сообщения с промптом в чате или группе,
    "chat": значение "chat" или "group" откуда промпт,
    "prompt_type": тип промпта "text" или "json"
}
```







## Правила построения формы
- Все типы объектов, их html код, в документе @docs/frontend/example_json_sample.md.
- Шаблон "template" по которому строится форма читается рекурсивно.
- В процессе получения объектов или полей для каждого из них вычисляется путь, который указывается в свойствах. 
- Каждое получаемое поле или объект вкладывается в родительский объект.
- Все шаблоны объектов хранить в файле @services/web_app/static/templates.js.
- Весь js код функции построения формы в файле @services/web_app/static/create_form.js.
- Форму поместить в DOM @services/web_app/templates/web_app.html на место <!-- Форма -->
- Все js скрипты обеспечивающие работу формы уже есть, поэтому нужно чтобы они работали по принципу делегирования событий.

## Краткий алгоритм построения формы
1. Рекурсивное чтение промпта в глубину, построение с самых глубоких неделимых типов.
2. получаем путь к элементу
3. Создаем html код объекта с помощью специальной функции в файле @docs/frontend/general_functions.md - get_element_by_path, в которую передаем: тип элемента, данные для генерации (значения свойств и тегов), дочерний (уже построенный код). Она получает шаблон элемента, вставляет все полученные значения и возвращает готовый html элемента. Этот элемент может быть вложен в следующий, более высокого уровня или в корень, если он уже построен полностью.
4. После построения всего кода монтируем его в объект dom и вставляем в указанное место.

