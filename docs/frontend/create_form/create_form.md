# Система динамического построения форм

Эта документация описывает систему, предназначенную для рекурсивной генерации HTML-форм на основе JSON-шаблона. Система состоит из нескольких уровней абстракции, что позволяет гибко управлять процессом создания как всей формы целиком, так и отдельных ее элементов.

## Архитектура и компоненты

Система построения форм состоит из трех основных компонентов, каждый из которых отвечает за свой уровень абстракции:

| Компонент | Уровень | Описание | Исходный код | Документация |
| :--- | :--- | :--- | :--- | :--- |
| **`createForm`** | **Высокий** | Рекурсивно строит всю форму или ее крупный фрагмент по заданному пути. Является основной точкой входа. | [`create_form.js`](../../../services/web_app/static/create_form.js) | (этот документ) |
| **`createElement`** | **Средний** | Создает один HTML-элемент (простой или контейнерный) по заданному пути. Используется функцией `createForm`. | [`create_element.js`](../../../services/web_app/static/create_element.js) | [`create_element_usage.md`](./create_element_usage.md) |
| **`renderTemplate`** | **Низкий** | Отрисовывает HTML-строку для одного элемента на основе данных и имени шаблона (например, 'text', 'boxTitle'). | [`templates.js`](../../../services/web_app/static/templates.js) | [`templates_usage.md`](./templates_usage.md) |

---

## Функция `createForm(path)`

Это основная функция-построитель, которая автоматически генерирует HTML-код для всей формы или для указанной ее части.

-   **Исходный код:** [`/services/web_app/static/create_form.js`](../../../services/web_app/static/create_form.js)

### Принцип работы

Функция работает рекурсивно:
1.  Она получает путь к элементу в шаблоне. Если путь пустой, она начинает с корня шаблона.
2.  Для каждого элемента-контейнера (`box`, `object`, `array`) она сначала рекурсивно вызывает себя для всех его дочерних элементов, чтобы получить их HTML-код.
3.  Собранный HTML дочерних элементов (`innerContent`) передается в функцию `createElement` для создания родительского элемента-обертки.
4.  Если функция встречает массив (`array`), она автоматически создает его первый дочерний элемент с индексом `_1`.
5.  Процесс продолжается до тех пор, пока не будет построен весь запрошенный фрагмент.

### Параметры

-   `path` (string, необязательный): Путь к элементу, который нужно построить.
    -   Если `path` не указан или является пустой строкой, функция строит всю форму с самого начала. Индексы для всех объектов в массивах по умолчанию устанавливаются в `1`.
    -   Если `path` указан (например, `scenes.scene_3`), функция построит только этот элемент и все его внутреннее содержимое. Индексы в продолжении пути (для вложенных массивов) также будут начинаться с `1`.

### Возвращаемое значение

-   (string): Готовая HTML-строка, представляющая собой запрошенный элемент или всю форму.

### Примеры использования

#### Пример 1: Построение всей формы

Вызов функции без параметров приведет к генерации полной формы на основе шаблона в `window.appData.template`.

```javascript
// 1. Убедитесь, что шаблон загружен
// window.appData.template = { ... };

// 2. Вызовите функцию без параметров
const fullFormHtml = createForm();

// 3. Вставьте результат на страницу
document.getElementById('form-container').innerHTML = fullFormHtml;
```

#### Пример 2: Построение конкретного элемента (объекта массива)

Этот вызов сгенерирует HTML только для третьего элемента в массиве `scenes`.

```javascript
const sceneHtml = createForm('scenes.scene_3');

// В переменной sceneHtml будет содержаться HTML-код для 
// <div data-path="scenes.scene_3" ...> ... </div>
// со всем его внутренним содержимым.
```

---

## Тестирование

Для проверки и отладки компонентов системы предусмотрены несколько тестовых страниц.

1.  **Интеграционное тестирование (`web_app_test.html`)**
    -   **Описание:** Это полноценная страница приложения, которая при запуске запрашивает файл шаблона и динамически строит всю форму. Это лучший способ проверить работу системы в условиях, приближенных к реальным.
    -   **Файл:** [`/services/web_app/templates/web_app_test.html`](../../../services/web_app/templates/web_app_test.html)

2.  **Модульное тестирование компонентов**
    -   **`createForm`:** Страница для изолированного тестирования функции `createForm`. Позволяет загрузить шаблон и сгенерировать как всю форму, так и ее отдельные части по указанному пути.
        -   **Файл:** [`/services/web_app/static/tests/create_form_test.html`](../../../services/web_app/static/tests/create_form_test.html)
    -   **`createElement`:** Страница для тестирования функции `createElement`, отвечающей за создание одиночных элементов.
        -   **Файл:** [`/services/web_app/static/tests/create_element_test.html`](../../../services/web_app/static/tests/create_element_test.html)
    -   **`renderTemplate`:** Страница для отладки и просмотра всех низкоуровневых HTML-шаблонов (поля, блоки, спойлеры и т.д.).
        -   **Файл:** [`/services/web_app/static/tests/templates_test.html`](../../../services/web_app/static/tests/templates_test.html)
