# Интерфейс mini-app приложения редактора промптов

## Описание
В верхней части экрана на всю ширину панель инструментов.  
Под панелью инструментов поле для работы с данными. В верхней части, как заголовок строка:
    - Редактирование промпта - если промпт был открыт из личного чата для редактирования или после сохранения
    - Новый промпт - если он был открыт из группы или создается новый и еще не сохранялся.

## Режимы работы
Приложение может находиться в одном из 3 режимов:
    - Формат - форма для редактирования форматированного промпта
    - Текст - форма для редактирования текстового промпта
    - Медиа - выбор, просмотр, удаление медиафайлов
В зависимости от этого меняются функции или вид элементов управления.

## Запуск приложения
Приложение может быть открыто из личного чата для редактирования или создания промпта или из группы публичных промптов. В зависимости от этого поведение немного отличается.  
Открывается приложение в одном из 2 режимов: 
    - в режиме Формат - при создании нового промпта или если форматируется JSON промпт
    - в режиме Текст - когда редактируется текстовый промпт.

## Кнопки
1. Слева на панели инструментов 3 кнопки для переключения режима работы редактора. Кнопка активного режима выделена. Режим может быть выбран при загрузке страницы, в процессе работы автоматически или пользователем.

2. Передалать в текст/Форматировать. Меняет значок и название в зависимости от режима:
    - в режиме Формат - Переделать в текст. Передает промпт в JSON формате на сервер, где он переводится в текст с помощью AI модели. Режим работы переключается в Текст, где в поле редактирования помещается полученный текст.
    - в режиме Текст - Форматировать. Передает текст на сервер, где производится попытка прочитать его как JSON, в случае неудачи переводится в JSON с помощью AI модели. Режим работы переключается в Формат, где промпт записывается в поля формы.
    - в режиме Медиа - Кнопка не активна.

3. Свернуть все спойлеры/Развернуть все спойлеры. Работает только для формы в режиме Формат, в остальных режимах не активна.

4. Очистить форму. Очистка форм в режимах Формат и Текст. В режиме Медиа - удаляет все медиафайлы. Форма приводится в исходное состояние.
    - в режиме Формат - удаляется из DOM и генерируется снова
    - в режиме Текст - очищается текстовое поле
    - режиме Медиа - приводится в исходный вид

5. Запомнить. Копирует содержимое формы в память:
    - в режиме Формат - в формате JSON
    - в режиме Текст - в формате текст
    - в режиме Медиа - запоминает список файлов

Независимая друг от друга область памяти.

6. Перевести (RU/EN). Перевод промпта между русским и английским.
    - в режиме Формат - передает промпт в JSON формате на сервер,где он переводится на противоположный язык, проверяется соответствие полей. Возвращается в том же формате и записывается в поля формы.
    - в режиме Текст - передает промпт как текст на сервер,где он переводится на противоположный язык. Возвращается в том же формате и записывается в текстовое поле формы.
    - в режиме Медиа - Кнопка не активна.

7. Восстановить. Очищает форму (приводит в исходное состояние) функцией кнопки Очистить форму. Восстанавливает значение из памяти:
    - в режиме Формат - удаление строй формы, восстановление из шаблона новой и вставка данных из json
    - в режиме Текст - очистка текстового поля, вставка текста
    - в режиме Медиа - очистка от данных, загрузка медиафайлов из сохраненного списка.

8. Копировать. Копирует в буфер обмена:
    - в режиме Формат - промпт в формате JSON
    - в режиме Текст - текст
    - в режиме Медиа - список файлов.

9. Сохранить. Перед сохранением выводится диалоговое окно:
    - Сохранить промпт в формате JSON? Если кнопка сохранения будет нажата в режиме Формат
    - Сохранить промпт как текст? Если кнопка сохранения будет нажата в режиме Текст
При этом, если промпт редактировался и исходный вариант был в другом формате об этом будет добавлена строка:
    - Ранее промпт был сохранен как JSON
    - Ранее промпт был сохранен как Текст
В случае подтверждения промпт в нужном виде будет отправлен на сервер вместе с медиафайлами, если они были добавлены.

## Если приложение открыто из группы
Промпт открытый из публичной группы считается не сохраненным (в личном чате он еще не сохранен), поэтому он помечается как новый. После сохранения промпта, для пользователя не стартовавшего личный чат с ботом, будет выведено предложение перейти в личный чат и стартонуть его: "Промпт сохранен для вас. Чтобы его увидеть, перейдите в чат с ботом @JPrompter и нажмите кнопку Старт.". Нужно нажать на кнопку Перейти или Нет.
