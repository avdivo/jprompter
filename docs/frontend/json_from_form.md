# Получение JSON-промпта из формы

При создании промпта используется форма имеющаяся в dom дереве и шаблон. Из них берется вся необходима информация для воссоздания структуры документа, получения данных и определения обязательности полей.  
- Структура исходящего документа должна соответствовать структуре шаблона (docs/frontend/create_form/example_json_sample.md).
- Без наличия заполненных обязательных полей промпт не создается. 
- Не заполненные поля не будут присутствовать в исходящем документе, и могут влиять на присутствие родительского блока.

## Правила включения полей в выходной документ

- Для включения объекта (поле: блок, массив или простое поле) в документ, хотя-бы одно из дочерних полей должно быть заполнено.
- Для простого поля - оно должно иметь значение
- Для объектов с содержимым - хотя бы один внутренний элемент должен иметь значение.
- Обязательные объекты помечаются полем "_important": true, его отсутствие или false говорит что объект не обязательный. 
- При наличии обязательных элементов хотя-бы один (если их несколько) должен иметь значение иначе родительское поле будет исключено.
- Не обязательные поля объекта влияют его включение только если отсутствует обязательное поле. Т.е. если обязательного нет, но хотя бы одно необязательное заполнено - родительское поле будет включено.
- Для всего шаблона отсутствие обязательного элемента в корне (если он есть) не позволяет создать выходной JSON.

## Обязательные поля в корне шаблона

Поля version и title обязательно должны быть в корне шаблона, их отсутствие не позволяет получить JSON-промпт. Они описаны docs/frontend/create_form/generate_web_page.md.

## Формирование JSON-ответа
Весь код собирающий ответ должен быть в файле services/web_app/static/json_prompt.js.
- Проверка обязательных полей и вывод сообщения если нет обязательных полей шаблона или они не заполнены
- Функция рекурсивно обходит шаблон window.appData.template (он создается в services/web_app/static/start.js)
- Пути получаемые при прохождении шаблона могут служить для поиска элементов в форме по свойству data-path, значения в них уникальны. Кроме объектов массивов, для них нужно вычислять возможные пути, подставляя индекс, проверять наличие таких элементов и заходить в них. Индексы всегда начинаются с 1 и идут последовательно, без пропусков.
- Для каждого поля определяется его тип чтобы правильно извлечь данные из формы (docs/frontend/create_form/example_json_sample.md)
- Для каждого поля определяется обязательность и учитывается при формировании ответа наверх по Правилам включения полей в выходной документ
- Таким образом собирается объект и возвращается из функции.
