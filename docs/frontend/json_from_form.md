# Получение JSON-промпта из формы

При создании промпта используется форма имеющаяся в dom дереве и шаблон. Из них берется вся необходима информация для воссоздания структуры документа, получения данных и определения обязательности полей.  
- Структура исходящего документа должна соответствовать структуре шаблона (docs/frontend/create_form/example_json_sample.md).
- Без наличия заполненных обязательных полей промпт не создается см. Обязательные поля в корне шаблона. 
- Не заполненные поля не будут присутствовать в исходящем документе, и могут влиять на присутствие родительского блока.

## Правила включения полей в выходной документ
```
объект это - поле: блок, массив или простое поле
```
- Поля не включаются, если они не заполнены или имеют значение none
- Объекты помеченные полем "_important": true - обязательны для заполнения.
- Если в объекте есть обязательные поля и ни одно из них не имеет значения (не заполнено) такой объект не включается в документ. Не обязательные поля при этом не играют роли.
- Если обязательных полей нет, то все заполненные поля попадают в документ вместе с родительским.
- Для всего шаблона отсутствие обязательного элемента в корне (если он есть, кроме Обязательные поля в корне шаблона) не позволяет создать выходной JSON.

## Обязательные поля в корне шаблона

Поля version и title обязательно должны быть в корне шаблона, их отсутствие не позволяет получить JSON-промпт. Они описаны docs/frontend/create_form/generate_web_page.md.

## Формирование JSON-ответа
Весь код собирающий ответ должен быть в файле services/web_app/static/json_prompt.js.
- Проверка Обязательные поля в корне шаблона. Если они не заполнены в форме вывести соответствующее сообщение: "Не указана версия шаблона"/"Не указано название промпта".
- Функция рекурсивно обходит шаблон window.appData.template (он создается в services/web_app/static/start.js)
- Пути получаемые при прохождении шаблона могут служить для поиска элементов в форме по свойству data-path, значения в них уникальны. Кроме объектов массивов, для них нужно вычислять возможные пути, подставляя индекс, проверять наличие таких элементов и заходить в них. Индексы всегда начинаются с 1 и идут последовательно, без пропусков.
- Для каждого поля определяется его тип чтобы правильно извлечь данные из формы (docs/frontend/create_form/example_json_sample.md)
- Для каждого поля определяется обязательность и учитывается при формировании ответа наверх по Правилам включения полей в выходной документ
- Таким образом собирается объект и возвращается из функции.
